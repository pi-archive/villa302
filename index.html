<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Villa 302: Final Archive</title>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Pen+Script&family=Noto+Serif+KR:wght@400;700&display=swap" rel="stylesheet">
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.1/firebase-database-compat.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>

    <style>
        :root { --neon-red: #ff3131; --neon-green: #39ff14; --msg-blue: #007aff; --apple-bg: #1c1c1e; }
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background: #000; color: white; overflow: hidden; font-family: -apple-system, sans-serif; }
        
        /* [1] ìƒë‹¨ ê³ ì • í”„ë¡œí•„ ë°” (ìš”ì²­ ë””í…Œì¼) */
        #user-info-bar { position: fixed; top: 20px; right: 20px; display: none; align-items: center; gap: 12px; background: rgba(0,0,0,0.8); padding: 8px 18px; border-radius: 50px; border: 1px solid var(--neon-green); z-index: 99999; backdrop-filter: blur(15px); }
        #bar-profile-pic { width: 36px; height: 36px; border-radius: 50%; background-size: cover; background-position: center; background-color: #333; border: 1px solid rgba(255,255,255,0.2); }
        #bar-username { font-weight: bold; font-size: 1rem; color: #fff; }

        /* [2] ì…ì¥ í˜ì´ì§€ (ì•”í˜¸ ë° ì„ íƒ) */
        #entry-page { position: fixed; top: 0; left: 0; width: 100vw; height: 100vh; background: url('villa interior.png') no-repeat center center/cover; z-index: 100000; display: flex; justify-content: center; align-items: center; }
        .lock-box { background: rgba(0,0,0,0.92); padding: 40px; border-radius: 35px; border: 1px solid rgba(255,255,255,0.1); width: 320px; text-align: center; backdrop-filter: blur(20px); }
        .user-sel-btn { flex: 1; padding: 18px; background: rgba(255,255,255,0.05); color: white; border: 1px solid #444; border-radius: 15px; cursor: pointer; font-weight: bold; }
        .user-sel-btn.active { border-color: var(--neon-green); color: var(--neon-green); background: rgba(57,255,20,0.1); }
        #pw-disp { font-size: 3rem; color: var(--neon-red); margin-bottom: 25px; height: 60px; letter-spacing: 12px; display: flex; align-items: center; justify-content: center; font-family: monospace; }
        .key-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; }
        .key { padding: 22px; background: rgba(255,255,255,0.08); border-radius: 15px; cursor: pointer; font-size: 1.4rem; transition: 0.1s; }
        .key:active { transform: scale(0.95); background: rgba(255,255,255,0.2); }

        /* [3] ê±°ì‹¤ ë©”ì¸ ìŠ¤í…Œì´ì§€ */
        #stage { position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 100vw; height: 66.67vw; max-width: 150vh; max-height: 100vh; background: url('villa.png') no-repeat center center/contain; background-color: #000; }
        .target { position: absolute; cursor: pointer; z-index: 10; border-radius: 15px; transition: 0.3s; }
        .target:hover { background: rgba(255,255,255,0.15); box-shadow: 0 0 20px rgba(255,255,255,0.2); }
        
        /* ê°€êµ¬ ìœ„ì¹˜ ë§¤ì¹­ */
        .wall-pos { top: 18%; left: 50%; width: 15%; height: 35%; } 
        .movie-pos { top: 8%; left: 63%; width: 20%; height: 15%; } 
        .cal-pos { top: 45%; left: 74%; width: 8%; height: 20%; } 
        .diary-pos { top: 52%; left: 57%; width: 13%; height: 8%; } 
        .photo-pos { top: 25%; left: 72%; width: 10%; height: 20%; } 
        .lib-pos { top: 35%; left: 35%; width: 12%; height: 25%; } 

        /* [4] ëª¨ë‹¬ ê³µí†µ ë ˆì´ì•„ì›ƒ */
        .modal { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.97); z-index: 80000; justify-content: center; align-items: center; }
        .modal-inner { background: var(--apple-bg); width: 92%; max-width: 850px; height: 85vh; border-radius: 35px; padding: 35px; overflow-y: auto; position: relative; border: 1px solid #333; }
        .close-btn { position: absolute; top: 25px; right: 35px; font-size: 3rem; color: #555; cursor: pointer; z-index: 100; }

        /* 8ëŒ€ ê¸°ëŠ¥ë³„ ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ */
        /* ìº˜ë¦°ë” */
        .cal-grid { display: grid; grid-template-columns: repeat(7, 1fr); gap: 6px; margin: 20px 0; }
        .cal-day { aspect-ratio: 1; background: #2c2c2e; border-radius: 10px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; border: 1px solid transparent; }
        .cal-day.active { border-color: var(--neon-green); background: rgba(57,255,20,0.05); }
        .emoji-scroll { display: flex; overflow-x: auto; gap: 20px; padding: 20px 0; border-top: 1px solid #333; }
        .emoji-item { text-align: center; cursor: pointer; flex-shrink: 0; opacity: 0.6; }
        .emoji-item.selected { opacity: 1; transform: scale(1.2); }
        .emoji-item span { font-size: 2rem; display: block; }

        /* ë°©ëª…ë¡(ì „ë‹¨ì§€) */
        .leaflet { background: #fff59d; color: #000; padding: 20px; font-family: 'Nanum Pen Script'; font-size: 1.6rem; transform: rotate(-1.5deg); box-shadow: 10px 10px 20px rgba(0,0,0,0.4); width: 160px; position: relative; word-break: break-all; }
        .tear-off { position: absolute; top: 5px; right: 8px; color: red; cursor: pointer; font-family: sans-serif; font-weight: bold; }

        /* ë‹¤ì´ì–´ë¦¬(iMessage) */
        #diary-chat { height: calc(100% - 150px); overflow-y: auto; background: #fff; border-radius: 25px; padding: 20px; display: flex; flex-direction: column; color: #000; }
        .chat-row { display: flex; margin-bottom: 15px; align-items: flex-end; }
        .chat-row.mine { flex-direction: row-reverse; }
        .chat-pic { width: 40px; height: 40px; border-radius: 50%; background-size: cover; margin: 0 10px; background-color: #eee; }
        .chat-bubble { max-width: 65%; padding: 12px 18px; border-radius: 20px; font-size: 1rem; line-height: 1.5; }
        .chat-bubble.mine { background: var(--msg-blue); color: #fff; border-bottom-right-radius: 4px; }
        .chat-bubble.yours { background: #e9e9eb; color: #000; border-bottom-left-radius: 4px; }

        /* ì˜í™”/ê°¤ëŸ¬ë¦¬ í”¼ë“œ */
        .card { background: #2c2c2e; border-radius: 20px; padding: 20px; margin-bottom: 20px; position: relative; }
        .insta-img { width: 100%; aspect-ratio: 1/1; border-radius: 15px; background-size: cover; background-position: center; margin: 10px 0; }

        /* ê³µí†µ ë²„íŠ¼/ì…ë ¥ */
        input, textarea, select { width: 100%; padding: 15px; background: #111; border: 1px solid #444; color: white; border-radius: 12px; margin-bottom: 12px; box-sizing: border-box; font-size: 1rem; }
        .btn-main { background: var(--msg-blue); color: white; border: none; padding: 15px; border-radius: 12px; width: 100%; cursor: pointer; font-weight: bold; font-size: 1.1rem; }
        #sitemap-btn { position: fixed; top: 25px; left: 25px; z-index: 99999; cursor: pointer; font-size: 1.8rem; background: rgba(255,255,255,0.1); width: 55px; height: 55px; border-radius: 15px; display: none; align-items: center; justify-content: center; backdrop-filter: blur(10px); }
    </style>
</head>
<body>

<div id="player"></div> <div id="sitemap-btn" onclick="openTab('sitemap')">â˜°</div>

<div id="user-info-bar">
    <div id="bar-profile-pic"></div>
    <div id="bar-username"></div>
</div>

<div id="entry-page">
    <div class="lock-box">
        <h2 style="color:white; margin-bottom:25px; letter-spacing: 2px;">VILLA 302</h2>
        <div style="display:flex; gap:12px; margin-bottom:25px;">
            <button onclick="selU('í‰í™”','1231')" id="b-í‰í™”" class="user-sel-btn">í‰í™”</button>
            <button onclick="selU('ì¸ì² ','0526')" id="b-ì¸ì² " class="user-sel-btn">ì¸ì² </button>
        </div>
        <div id="pw-disp">----</div>
        <div class="key-grid">
            <script>for(let i=1; i<=9; i++) document.write(`<div class="key" onclick="press('${i}')">${i}</div>`);</script>
            <div class="key" onclick="inputPw=''; updatePw();">C</div>
            <div class="key" onclick="press('0')">0</div>
            <div class="key" style="background:var(--neon-red)" onclick="checkPw()">E</div>
        </div>
    </div>
</div>

<div id="stage">
    <div class="target wall-pos" title="ë°©ëª…ë¡" onclick="openTab('wall')"></div>
    <div class="target movie-pos" title="ì˜í™”" onclick="openTab('movie')"></div>
    <div class="target cal-pos" title="ë‹¬ë ¥" onclick="openTab('calendar')"></div>
    <div class="target diary-pos" title="ì¼ê¸°" onclick="openTab('diary')"></div>
    <div class="target photo-pos" title="ê°¤ëŸ¬ë¦¬" onclick="openTab('gallery')"></div>
    <div class="target lib-pos" title="ì„œì¬" onclick="openTab('library')"></div>
</div>

<div id="main-modal" class="modal">
    <div class="modal-inner">
        <span class="close-btn" onclick="closeModal()">Ã—</span>
        <div id="modal-content"></div>
    </div>
</div>

<script>
    // --- [Firebase ë° ì´ˆê¸°í™”] ---
    const firebaseConfig = {
        apiKey: "AIzaSyDLTGv4Z3zJUseuKw1acvHHwPzooZhXodc",
        databaseURL: "https://villa302-default-rtdb.firebaseio.com",
        projectId: "villa302",
        appId: "1:166700659009:web:18c2872914aab8b4bbf1c0"
    };
    firebase.initializeApp(firebaseConfig);
    const db = firebase.database();

    let currentUser = "", targetPw = "", inputPw = "", userProfiles = {}, ytPlayer, selDate = "", selEmoji = "";
    const emojiList = [
        {e:'ğŸŸ', l:'ë°ì´íŠ¸'}, {e:'ğŸš—', l:'ì¶œê·¼'}, {e:'ğŸ ', l:'íœ´ì‹'}, 
        {e:'ğŸ—', l:'ì•¼ì‹'}, {e:'ğŸ’¼', l:'ì—…ë¬´'}, {e:'â¤ï¸', l:'ê¸°ë…ì¼'},
        {e:'âœˆï¸', l:'ì—¬í–‰'}, {e:'ğŸ¥', l:'ë³‘ì›'}, {e:'â˜•', l:'ì•½ì†'}
    ];

    // --- [UX ê¸°ëŠ¥: ì…ì¥, ESC, ìƒë‹¨ë°”] ---
    function selU(u,p) { currentUser=u; targetPw=p; inputPw=""; document.querySelectorAll('.user-sel-btn').forEach(b=>b.classList.remove('active')); document.getElementById('b-'+u).classList.add('active'); updatePw(); }
    function press(n) { if(inputPw.length<4) inputPw+=n; updatePw(); }
    function updatePw() { document.getElementById('pw-disp').innerText = "*".repeat(inputPw.length)||"----"; }
    
    function checkPw() {
        if(inputPw === targetPw) {
            document.getElementById('entry-page').style.display='none';
            document.getElementById('user-info-bar').style.display='flex';
            document.getElementById('sitemap-btn').style.display='flex';
            document.getElementById('bar-username').innerText = currentUser + "ë‹˜";
            db.ref('profiles').on('value', s => { 
                userProfiles = s.val() || {}; 
                if(userProfiles[currentUser]) document.getElementById('bar-profile-pic').style.backgroundImage = `url('${userProfiles[currentUser]}')`;
            });
            initBGM();
        } else { alert("ì•”í˜¸ê°€ í‹€ë ¸ìŠµë‹ˆë‹¤."); inputPw=""; updatePw(); }
    }

    // ESC ë‹«ê¸° ë””í…Œì¼
    window.addEventListener('keydown', (e) => {
        if(e.key === 'Escape') closeModal();
        if(document.getElementById('entry-page').style.display !== 'none' && e.key >= '0' && e.key <= '9') press(e.key);
        if(e.key === 'Enter' && inputPw.length === 4) checkPw();
    });

    function closeModal() { document.getElementById('main-modal').style.display = 'none'; }

    // --- [BGM Logic] ---
    function onYouTubeIframeAPIReady() { ytPlayer = new YT.Player('player', { height: '0', width: '0', events: { 'onReady': () => console.log("BGM ì‹œìŠ¤í…œ ê°€ë™") }}); }
    function initBGM() {
        db.ref('bgm_list_v3').on('value', s => {
            const list = Object.values(s.val() || {});
            if(list.length && ytPlayer && ytPlayer.loadPlaylist) ytPlayer.loadPlaylist(list.map(i => i.id));
        });
    }

    // --- [ëª¨ë‹¬ íƒ­ ì „í™˜ ë° 8ëŒ€ ê¸°ëŠ¥] ---
    function openTab(id) {
        const content = document.getElementById('modal-content');
        document.getElementById('main-modal').style.display = 'flex';
        
        if(id === 'calendar') {
            content.innerHTML = `<h3>ğŸ“… VILLA CALENDAR</h3><div class="cal-grid" id="cal-grid"></div>
                <div id="cal-editor" style="display:none; border-top:1px solid #33)3; padding-top:20px;">
                    <h4 id="sel-date-label"></h4>
                    <div class="emoji-scroll" id="emoji-picker"></div>
                    <input id="cal-memo" placeholder="ìƒì„¸ ì¼ì •ì„ ì…ë ¥í•˜ì„¸ìš” (ìˆ˜ì • ê°€ëŠ¥)">
                    <button class="btn-main" onclick="saveCal()">ì¼ì • ì €ì¥í•˜ê¸°</button>
                    <div id="day-info" style="margin-top:20px; padding:15px; background:#111; border-radius:12px;"></div>
                </div>`;
            renderCal();
        } else if(id === 'wall') {
            content.innerHTML = `<h3>ğŸ§± THE WALL</h3><textarea id="wl-i" placeholder="ë©”ì‹œì§€ë¥¼ ì…ë ¥í•˜ì„¸ìš”..."></textarea><button class="btn-main" onclick="addWl()">ë²½ì— ë¶™ì´ê¸°</button><div class="leaflet-container" id="wl-list" style="display:flex; flex-wrap:wrap; gap:15px; margin-top:20px;"></div>`;
            renderWl();
        } else if(id === 'diary') {
            content.innerHTML = `<h3>ğŸ“– SECRET DIARY</h3><div id="diary-chat"></div><div style="display:flex; gap:10px; margin-top:15px;"><textarea id="dy-i" style="height:60px; margin:0;"></textarea><button class="btn-main" style="width:70px;" onclick="addDy()">ë³´ë‚´ê¸°</button></div>`;
            renderDy();
        } else if(id === 'movie') {
            content.innerHTML = `<h3>ğŸ¬ MOVIE LOG</h3><input id="mv-t" placeholder="ì˜í™” ì œëª©"><textarea id="mv-r" placeholder="ê°ìƒí‰"></textarea><select id="mv-s"><option value="5">â­â­â­â­â­</option><option value="4">â­â­â­â­</option></select><button class="btn-main" onclick="addMv()">ë¡œê·¸ ì¶”ê°€</button><div id="mv-list"></div>`;
            renderMv();
        } else if(id === 'gallery') {
            content.innerHTML = `<h3>ğŸ“¸ GALLERY</h3><input type="file" onchange="addPic(this)"><div id="gal-list"></div>`;
            renderPic();
        } else if(id === 'library') {
            content.innerHTML = `<h3>ğŸ“š LIBRARY</h3><input id="lb-t" placeholder="ë„ì„œëª…"><input id="lb-a" placeholder="ì €ì"><button class="btn-main" onclick="addLb()">ì±…ì¥ì— ë„£ê¸°</button><div id="lb-list"></div>`;
            renderLb();
        } else if(id === 'bgm') {
            content.innerHTML = `<h3>ğŸµ BGM PLAYLIST</h3><input id="bg-id" placeholder="ìœ íŠœë¸Œ ì˜ìƒ ID (ì˜ˆ: dQw4w9WgXcQ)"><input id="bg-t" placeholder="ê³¡ ì œëª©"><button class="btn-main" onclick="addBgm()">ë¦¬ìŠ¤íŠ¸ ì¶”ê°€</button><div id="bg-list"></div>`;
            renderBgm();
        } else if(id === 'profile') {
            content.innerHTML = `<h3>ğŸ‘¤ PROFILE SETTING</h3><div id="pf-pre" style="width:120px; height:120px; border-radius:50%; margin:20px auto; background-size:cover; border:2px solid var(--neon-green); background-image:url('${userProfiles[currentUser]||''}')"></div><input type="file" onchange="prePf(this)"><button class="btn-main" onclick="savePf()">í”„ë¡œí•„ ì €ì¥</button>`;
        } else if(id === 'sitemap') {
            content.innerHTML = `<h3>SITEMAP</h3><div style="display:grid; grid-template-columns:1fr 1fr; gap:15px;">${['calendar','wall','diary','movie','gallery','library','bgm','profile'].map(m=>`<button class="btn-main" style="background:#333;" onclick="openTab('${m}')">${m.toUpperCase()}</button>`).join('')}</div>`;
        }
    }

    // --- [ê¸°ëŠ¥ ìƒì„¸ ë¡œì§ (Firebase ë°ì´í„° ì²˜ë¦¬)] ---

    // 1. ìº˜ë¦°ë” (ì´ëª¨ì§€ ì„ íƒí˜•)
    function renderCal() {
        const grid = document.getElementById('cal-grid'); if(!grid) return;
        const now = new Date();
        const days = new Date(now.getFullYear(), now.getMonth() + 1, 0).getDate();
        db.ref('calendar_v3').on('value', s => {
            const data = s.val() || {}; grid.innerHTML = "";
            for(let i=1; i<=days; i++) {
                const k = `${now.getFullYear()}-${now.getMonth()+1}-${i}`;
                grid.innerHTML += `<div class="cal-day ${selDate===k?'active':''}" onclick="clickDay('${k}')"><span>${i}</span><b style="font-size:1.2rem">${data[k]?data[k].emoji:''}</b></div>`;
            }
        });
    }
    function clickDay(d) {
        selDate = d; document.getElementById('cal-editor').style.display = "block";
        document.getElementById('sel-date-label').innerText = d + " ì¼ì • ì„¤ì •";
        const picker = document.getElementById('emoji-picker');
        picker.innerHTML = emojiList.map(i => `<div class="emoji-item ${selEmoji===i.e?'selected':''}" onclick="selEmoji='${i.e}';clickDay('${d}')"><span>${i.e}</span><small>${i.l}</small></div>`).join('');
        db.ref('calendar_v3/'+d).once('value', s => {
            const v = s.val(); const info = document.getElementById('day-info');
            if(v) { info.innerHTML = `<b>${v.u}</b>: ${v.emoji} ${v.memo} <button onclick="db.ref('calendar_v3/${d}').remove()" style="color:red; background:none; border:none;">ì‚­ì œ</button>`; document.getElementById('cal-memo').value = v.memo; selEmoji = v.emoji; }
            else { info.innerHTML = "ë“±ë¡ëœ ì¼ì •ì´ ì—†ìŠµë‹ˆë‹¤."; document.getElementById('cal-memo').value = ""; }
        });
        renderCal();
    }
    function saveCal() { const m = document.getElementById('cal-memo').value; if(selEmoji) db.ref('calendar_v3/'+selDate).set({emoji:selEmoji, memo:m, u:currentUser}); }

    // 2. ë‹¤ì´ì–´ë¦¬ (iMessage ìŠ¤íƒ€ì¼)
    function addDy() { const t = document.getElementById('dy-i').value; if(t) db.ref('diary_v3').push({t, u:currentUser}); document.getElementById('dy-i').value=""; }
    function renderDy() {
        db.ref('diary_v3').on('value', s => {
            const chat = document.getElementById('diary-chat'); if(!chat) return;
            chat.innerHTML = ""; const d = s.val();
            if(d) Object.values(d).forEach(v => {
                const isM = v.u === currentUser;
                chat.innerHTML += `<div class="chat-row ${isM?'mine':''}">
                    <div class="chat-pic" style="background-image:url('${userProfiles[v.u]||''}')"></div>
                    <div class="chat-bubble ${isM?'mine':'yours'}">${v.t}</div>
                </div>`;
            });
            chat.scrollTop = chat.scrollHeight;
        });
    }

    // 3. ë°©ëª…ë¡ (ì „ë‹¨ì§€)
    function addWl() { const t = document.getElementById('wl-i').value; if(t) db.ref('wall_v3').push({t, u:currentUser}); document.getElementById('wl-i').value=""; }
    function renderWl() {
        db.ref('wall_v3').on('value', s => {
            const list = document.getElementById('wl-list'); if(!list) return;
            list.innerHTML = ""; const d = s.val();
            if(d) Object.keys(d).forEach(k => {
                list.innerHTML += `<div class="leaflet"><span class="tear-off" onclick="db.ref('wall_v3/${k}').remove()">âœ•</span>${d[k].t}<br><br><small>- From. ${d[k].u}</small></div>`;
            });
        });
    }

    // 4. ì˜í™” ë¡œê·¸
    function addMv() { const t = document.getElementById('mv-t').value, r = document.getElementById('mv-r').value, s = document.getElementById('mv-s').value; if(t) db.ref('movie_v3').push({t, r, s, u:currentUser}); }
    function renderMv() {
        db.ref('movie_v3').on('value', s => {
            const list = document.getElementById('mv-list'); if(!list) return;
            list.innerHTML = ""; const d = s.val();
            if(d) Object.keys(d).reverse().forEach(k => {
                list.innerHTML += `<div class="card"><b>${d[k].t}</b> <span style="color:gold">${'â˜…'.repeat(d[k].s)}</span><p>${d[k].r}</p><small>by ${d[k].u}</small></div>`;
            });
        });
    }

    // 5. ê°¤ëŸ¬ë¦¬
    function addPic(i) { if(i.files[0]) { const r = new FileReader(); r.onload=e=>db.ref('gallery_v3').push({img:e.target.result, u:currentUser}); r.readAsDataURL(i.files[0]); } }
    function renderPic() {
        db.ref('gallery_v3').on('value', s => {
            const list = document.getElementById('gal-list'); if(!list) return;
            list.innerHTML = ""; const d = s.val();
            if(d) Object.values(d).reverse().forEach(v => {
                list.innerHTML += `<div class="card"><div class="insta-img" style="background-image:url('${v.img}')"></div><small>Posted by ${v.u}</small></div>`;
            });
        });
    }

    // 6. ì„œì¬
    function addLb() { const t = document.getElementById('lb-t').value, a = document.getElementById('lb-a').value; if(t) db.ref('library_v3').push({t, a, u:currentUser}); }
    function renderLb() {
        db.ref('library_v3').on('value', s => {
            const list = document.getElementById('lb-list'); if(!list) return;
            list.innerHTML = ""; const d = s.val();
            if(d) Object.values(d).reverse().forEach(v => {
                list.innerHTML += `<div style="padding:10px; border-bottom:1px solid #333;">ğŸ“– <b>${v.t}</b> - ${v.a} <small>(ì¶”ì²œ: ${v.u})</small></div>`;
            });
        });
    }

    // 7. BGM
    function addBgm() { const id = document.getElementById('bg-id').value, t = document.getElementById('bg-t').value; if(id) db.ref('bgm_list_v3').push({id, t}); }
    function renderBgm() {
        db.ref('bgm_list_v3').on('value', s => {
            const list = document.getElementById('bg-list'); if(!list) return;
            list.innerHTML = ""; const d = s.val();
            if(d) Object.keys(d).forEach(k => {
                list.innerHTML += `<div style="display:flex; justify-content:space-between; padding:10px; background:#111; margin-top:5px; border-radius:8px;"><span>${d[k].t}</span><button onclick="db.ref('bgm_list_v3/${k}').remove()" style="color:red; background:none; border:none;">ì‚­ì œ</button></div>`;
            });
        });
    }

    // 8. í”„ë¡œí•„ ì €ì¥
    let tPic = "";
    function prePf(i) { if(i.files[0]) { const r = new FileReader(); r.onload=e=>{ document.getElementById('pf-pre').style.backgroundImage=`url('${e.target.result}')`; tPic=e.target.result; }; r.readAsDataURL(i.files[0]); } }
    function savePf() { if(tPic) db.ref('profiles/'+currentUser).set(tPic).then(()=>alert("ì €ì¥ ì™„ë£Œ!")); }

</script>
</body>
</html>